Product Requirements Document (PRD)Project Name: Digital Twin Swap Station Network (Simulation Sandbox)Version: 1.0Status: Draft1. Executive SummaryThe Digital Twin Simulation Sandbox is a decision-support tool designed to model a city-wide battery swap network. It allows operations teams to run "what-if" experiments (counterfactual analysis) to predict the impact of changes in infrastructure, inventory, or external demand before physical deployment. The system will simulate network dynamics to minimize capital risk and optimize operational efficiency.2. Problem Statement & ObjectiveCurrent State: Network changes (e.g., adding a station, changing charging logic) are high-cost and high-risk. Planning relies on static spreadsheets which fail to capture queuing dynamics and network effects.Objective: Build a discrete-event simulation (DES) that accurately reproduces historical baseline performance and predicts future KPIs under various intervention scenarios with >90% accuracy.3. Twin Model Design3.1. Station Node ModelEach station is modeled as a finite-capacity queuing system (G/G/k queue variation).Attributes:Location: (Lat, Long, Grid ID)Hardware Profile: Number of Bays, Charger Power (kW), Swap Service Time (seconds).Inventory State: Total Batteries, Count of Fully Charged (SoC > 95%), Count of Charging, Count of Empty.State Machine:Idle: Station open, slots available.Service (Swapping): Robot/User exchanging battery (consumes Service Time).Charging: Occupied slot increasing SoC based on non-linear charging curve.Stockout: Demand arrives but Fully Charged < 1. (Triggers Lost Swap or Wait Queue).3.2. Constraints & PhysicsGrid Constraint: Maximum power draw per station (cannot charge all batteries at max speed simultaneously if grid cap is hit).Battery Cooling: Mandatory cool-down period post-swap before charging begins.Throughput Cap: Maximum swaps per hour = $\min(\text{Bays} \times \frac{3600}{\text{ServiceTime}}, \text{Chargers} \times \text{ChargeRate})$.4. Simulation ApproachSelected Method: Discrete-Event Simulation (DES)Rationale: Unlike time-step models which aggregate data (e.g., hourly averages), DES simulates every single vehicle arrival and battery state change. This is critical for capturing "bursty" behavior, such as a sudden queue forming during a 10-minute rush, which averages would smooth out and hide.Time Resolution: Millisecond precision, aggregated to 15-minute buckets for reporting.Event Loop:Vehicle_Arrival_EventSwap_Start_EventSwap_End_EventBattery_Charge_Complete_Event5. Functional Requirements5.1. Input Data IngestionThe system must ingest and standardize the following datasets:| Data Category | Parameters || :--- | :--- || Topology | Station IDs, Geo-coordinates, distance matrix (travel times between nodes). || Historical Demand | Timestamped swap logs (Arrival Time, Station ID). || Station Config | Charger count, total bays, initial battery stock, grid power limit. |5.2. Scenario Interventions (Configuration)Users must be able to configure specific "What-If" scenarios via a config file or UI:Infrastructure: Add/Remove Station Node; Modify Charger_Count or Bay_Count.Policy: Change Min_SoC_Threshold (e.g., allow swapping at 80% instead of 90%).Demand Logic: Apply multipliers (e.g., Demand * 1.5 for festivals) or shift demand curves (e.g., Rain_Event = -20% demand).5.3. Outputs & KPI DashboardThe dashboard will display a Split-View Comparison (Baseline vs. Scenario).Primary KPIs:Customer Experience:Avg Wait Time: Time from arrival to swap start.Lost Swaps (Stockouts): Count of users leaving due to >$X$ min wait or 0 stock.Operational Efficiency:Charger Utilization: % of time chargers are active.Idle Inventory: Average % of fully charged batteries sitting unused.City Throughput: Total successful swaps per day.Financial:OpEx Impact: Estimated energy cost + battery depreciation.6. Validation & Calibration ApproachTo trust the "What-If" scenarios, the "Baseline" must be proven accurate.Backtesting Strategy: Run the simulation using last month's input data. Compare the Simulated Output against the Actual Historical Logs.Error Band Acceptance:Total Swaps: $\pm 2\%$Wait Time peaks: $\pm 5\%$Energy Consumption: $\pm 5\%$Tuning: If the model deviates, calibrate the "human factors" (e.g., random delay in parking) or "charging curves" (impact of ambient temperature) until the baseline fits.7. Example Scenario WalkthroughScenario Name: Diwali Festival Surge & New Station RolloutHypothesis: Adding a "Pop-up Station" in Sector 4 will reduce wait times in Sector 5 by 15% during the Diwali rush.Configuration:Demand_Multiplier: 1.4x (Global).New_Node: [Lat/Long of Sector 4], 4 Chargers, 10 Batteries.Traffic_Congestion: Increase travel time between nodes by 20%.Expected Output:Baseline (No new station): Sector 5 experiences 40 min avg wait; 120 lost swaps.Scenario (With Pop-up): Sector 5 wait drops to 22 min; 30 lost swaps. Sector 4 handles 200 swaps.Decision: The cost of the pop-up station is justified by the retention of 90 swaps.8. Success Metrics (Project Success)Baseline Accuracy: The Twin reproduces historical "Lost Swaps" count with >90% accuracy.Simulation Speed: Can simulate 1 week of city operations in <5 minutes.Decision Utility: The dashboard clearly highlights the "Winning Scenario" based on a weighted score of Revenue vs. Cost.9. Technical Stack Recommendations (Optional)Simulation Engine: Python (SimPy) or AnyLogic.Data Processing: Pandas/Polars for time-series handling.Visualization: Streamlit or Dash for the interactive KPI dashboard.Database: TimescaleDB or SQLite for storing simulation logs.